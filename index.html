<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pizzaria Farinha & Lenha ‚Äî Pedidos Online</title>
  <meta name="description" content="Pizzas de longa fermenta√ß√£o, forno √† lenha. Salgadas 35 cm, doces 25 cm. Atendimento 18h‚Äì23h.">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>html{scroll-behavior:smooth}</style>
</head>
<body class="bg-neutral-100">
  <header class="bg-white border-b sticky top-0 z-30">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-black">Pizzaria Farinha & Lenha üçï</h1>
        <p class="text-xs text-neutral-500">Massa de longa fermenta√ß√£o ‚Ä¢ Forno √† lenha ‚Ä¢ Salgadas 35 cm ‚Ä¢ Doces 25 cm</p>
      </div>
      <a href="#carrinho" class="rounded-lg px-3 py-2 bg-neutral-900 text-white text-sm font-semibold">Carrinho</a>
    </div>
  </header>

  <div id="hoursBanner" class="hidden bg-yellow-100 border-b border-yellow-300 text-yellow-900">
    <div class="max-w-6xl mx-auto px-4 py-3 text-sm">
      Oi! üòÑ Nosso hor√°rio de atendimento √© das <b>18h √†s 23h</b>. Assim que abrirmos, volto pra te atender rapidinho üçï.<br>
      üìû (22) 99229-0283 | @farinhalenha | Pizzaria Farinha & Lenha üçï.
    </div>
  </div>

  <main class="max-w-6xl mx-auto p-4">
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <div class="lg:col-span-2 space-y-4">
        <section class="bg-white rounded-2xl shadow p-4">
          <h2 class="text-xl font-semibold mb-1">Card√°pio ‚Äî Tradicionais <span class="text-neutral-500">(R$ 43,90)</span></h2>
          <div id="menu-trad" class="space-y-3"></div>
        </section>
        <section class="bg-white rounded-2xl shadow p-4">
          <h2 class="text-xl font-semibold mb-1">Card√°pio ‚Äî Premium <span class="text-neutral-500">(R$ 50,90)</span></h2>
          <div id="menu-prem" class="space-y-3"></div>
        </section>
        <section class="bg-white rounded-2xl shadow p-4">
          <h2 class="text-xl font-semibold mb-1">Card√°pio ‚Äî Doces <span class="text-neutral-500">(R$ 30,00)</span></h2>
          <div id="menu-doces" class="space-y-3"></div>
        </section>
        <section class="bg-white rounded-2xl shadow p-4">
          <h2 class="text-xl font-semibold mb-1">Bebidas</h2>
          <div id="menu-bebidas" class="space-y-3"></div>
        </section>
        <section class="bg-white rounded-2xl shadow p-4">
          <h2 class="text-xl font-semibold mb-1">Combos</h2>
          <div id="menu-combos" class="space-y-3"></div>
          <p class="text-sm text-neutral-600 mt-2">Voc√™ escolhe o sabor da pizza e o refrigerante üòã.</p>
        </section>

        <section class="bg-white rounded-2xl shadow p-4">
          <h2 class="text-xl font-semibold mb-1">Taxas de Entrega</h2>
          <p class="text-sm text-neutral-600">Informe seu bairro no carrinho para calcular automaticamente.</p>
          <details class="mt-2">
            <summary class="cursor-pointer text-sm font-semibold">Ver tabela completa</summary>
            <div id="taxasTabela" class="text-sm text-neutral-700 mt-2"></div>
          </details>
        </section>

        <section class="bg-white rounded-2xl shadow p-4">
          <h2 class="text-xl font-semibold mb-1">Formas de Pagamento</h2>
          <p class="text-sm text-neutral-700">
            Aceitamos dinheiro, Pix, cart√£o de cr√©dito e d√©bito. Se for em dinheiro, avise se precisa de troco üí∏.
          </p>
        </section>
      </div>

      <aside id="carrinho" class="bg-white rounded-2xl shadow p-4 h-max sticky top-20">
        <h2 class="text-xl font-semibold mb-2">Seu carrinho</h2>
        <div id="cart" class="text-sm text-neutral-700"></div>
        <hr class="my-3">
        <div class="grid grid-cols-1 gap-2">
          <select id="retiradaEntrega" class="border rounded-lg p-2 text-sm">
            <option value="">Entrega ou retirada?</option>
            <option value="retirada">Retirada na pizzaria</option>
            <option value="entrega">Entrega</option>
          </select>
          <input id="bairro" class="border rounded-lg p-2 text-sm" placeholder="Bairro (para calcular taxa)">
          <input id="nome" class="border rounded-lg p-2 text-sm" placeholder="Seu nome">
          <input id="endereco" class="border rounded-lg p-2 text-sm" placeholder="Endere√ßo (se entrega)">
          <input id="telefone" class="border rounded-lg p-2 text-sm" placeholder="Telefone">
          <select id="pagamento" class="border rounded-lg p-2 text-sm">
            <option value="">Forma de pagamento</option>
            <option>Pix</option><option>Cr√©dito</option><option>D√©bito</option><option>Dinheiro</option>
          </select>
          <input id="troco" class="border rounded-lg p-2 text-sm" placeholder="Troco para (se dinheiro)">
          <textarea id="obs" class="w-full border rounded-lg p-2 text-sm" rows="3" placeholder="Sem cebola, cortar em 8, etc."></textarea>
        </div>
        <div class="mt-4 flex gap-2">
          <button id="btn-whatsapp" class="flex-1 rounded-xl px-4 py-3 font-semibold bg-green-600 text-white">WhatsApp</button>
          <button id="btn-site" class="flex-1 rounded-xl px-4 py-3 font-semibold bg-blue-600 text-white">Finalizar</button>
        </div>
        <p class="text-xs text-neutral-500 mt-2">‚ÄúFinalizar‚Äù envia para a ponte de impress√£o (80mm) via PRINT_WEBHOOK.</p>
        <p class="text-xs text-neutral-500">Tempo m√©dio de preparo: ~40 minutos (pode variar conforme o movimento) üçï.</p>
      </aside>
    </section>
  </main>

  <footer class="text-center text-xs text-neutral-500 py-10">
    ¬© <span id="year"></span> Pizzaria Farinha & Lenha ‚Äî Travessa Curitiba, 12 ‚Äì Jardim Olinda, Cabo Frio ‚Äì RJ
  </footer>

  <script>
  // ========= CONFIG =========
  const STORE_NAME = "Pizzaria Farinha & Lenha";
  const WHATSAPP_NUM = "+5522992290283";
  const TIMEZONE = "America/Sao_Paulo";
  const OPEN_HOUR = 18, CLOSE_HOUR = 23; // 18h‚Äì23h
  const PRINT_WEBHOOK = localStorage.getItem("PRINT_WEBHOOK") || "";
  const PRINT_KEY = localStorage.getItem("PRINT_KEY") || ""; // opcional: se setado, envia header X-KEY

  const em = (v)=> v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

  // ========= MENU =========
  const TRADICIONAIS = [
    {id:"mussarela", name:"Mussarela", price:43.90, desc:"molho, mussarela e or√©gano."},
    {id:"calabresa", name:"Calabresa", price:43.90, desc:"molho, mussarela, calabresa, cebola e or√©gano."},
    {id:"alho", name:"Alho", price:43.90, desc:"molho, mussarela, alho e or√©gano."},
    {id:"presunto", name:"Presunto", price:43.90, desc:"molho, mussarela, presunto e or√©gano."},
    {id:"marguerita", name:"Marguerita", price:43.90, desc:"molho, mussarela, tomate, manjeric√£o e or√©gano."},
  ];
  const PREMIUM = [
    {id:"quatro-queijos", name:"Quatro Queijos", price:50.90, desc:"mussarela, provolone, parmes√£o, catupiry e or√©gano."},
    {id:"camarao-catupiry", name:"Camar√£o c/ Catupiry", price:50.90, desc:"mussarela, camar√£o, catupiry e or√©gano."},
    {id:"bacon", name:"Bacon", price:50.90, desc:"mussarela, bacon e or√©gano."},
    {id:"bacon-ovos", name:"Bacon c/ Ovos", price:50.90, desc:"mussarela, bacon, ovos e or√©gano."},
    {id:"frango", name:"Frango", price:50.90, desc:"mussarela, frango desfiado e or√©gano."},
    {id:"frango-catupiry", name:"Frango c/ Catupiry", price:50.90, desc:"mussarela, frango desfiado, catupiry e or√©gano."},
    {id:"portuguesa", name:"Portuguesa", price:50.90, desc:"mussarela, piment√£o, cebola, ovo, tomate, calabresa e or√©gano."},
    {id:"tres-porquinhos", name:"Tr√™s Porquinhos", price:50.90, desc:"mussarela, presunto, bacon, calabresa e or√©gano."},
  ];
  const DOCES = [
    {id:"chocolate", name:"Chocolate", price:30.00, desc:""},
    {id:"prestigio", name:"Prest√≠gio", price:30.00, desc:"chocolate e coco ralado."},
    {id:"pacoca", name:"Pa√ßoca", price:30.00, desc:"chocolate e pa√ßoca."},
  ];
  const BEBIDAS = [
    {id:"guarana15", name:"Guaran√° Ant√°rtica 1,5L", price:12.00},
    {id:"guaranaz15", name:"Guaran√° Ant√°rtica Zero 1,5L", price:12.00},
    {id:"coca15", name:"Coca-Cola 1,5L", price:13.00},
    {id:"cocaz15", name:"Coca-Cola Zero 1,5L", price:13.00},
  ];
  const COMBOS = [
    {id:"combo1", name:"Combo 1", price:50.90, desc:"1 Pizza Tradicional (35 cm) + 1 Refrigerante 1,5L"},
    {id:"combo2", name:"Combo 2", price:57.90, desc:"1 Pizza Premium (35 cm) + 1 Broto Doce (25 cm)"},
  ];

  // ========= TAXAS =========
  const TAXAS = [
    {valor:6.99, bairros:["Centro"]},
    {valor:8.00, bairros:["S√£o Bento","Passagem","Vila Nova","Jardim Machado","Itajuru","Orla da Praia","Vila Nova","Algodoal","Parque Riviera","Braga","Parque Central","Portinho","Jardim Flamboyant","Jardim Cai√ßara","Palmeiras","Novo Portinho","Jardim Excelsior","S√£o Crist√≥v√£o","S√£o Francisco","Ville Blanche","Morub√°","Buraco do Boi","Parque Burle","Praia do Siqueira (at√© a avenida)"]},
    {valor:10.00, bairros:["Praia do Siqueira (ap√≥s a avenida)","Jardim N√°utilus","Guarani","C√©lula M√°ter","Jardim Olinda","Jacar√©","Gamboa","Manoel Corr√™a","Portinho (Ilha do Anjo)"]},
    {valor:12.00, bairros:["Dunas","Recanto das Dunas","Boca do Mato"]},
    {valor:15.00, bairros:["Vila do Sol","Vila do Ar","Jardim Esperan√ßa","Porto do Carro","Bosque do Per√≥","Condom√≠nio dos P√°ssaros","Per√≥","Ogiva","Caminho Verde","Foguete","Baixo Grande","Vinhateiro","Monte Alegre 1 e 2"]},
    {valor:20.00, bairros:["Tangar√°","Guriri","Jardim Per√≥","Reserva do Per√≥","Parque Eldorado","Caminho de B√∫zios","Minha Casa Minha Vida","Campo Redondo","Bairro S√£o Jo√£o","Parque Estoril","Alecrim"]},
    {valor:25.00, bairros:["Arraial do Cabo (Centro)","S√£o Pedro (Centro)","Jos√© Gon√ßalves","Aeroporto"]},
    {valor:30.00, bairros:["Balne√°rio","Po√ßo Fundo","Praia do Sudoeste","Boqueir√£o","Pontal do Atalaia","Jardim das Ac√°cias","Monte Alto"]},
    {valor:35.00, bairros:["Praia Linda","Baleia","Figueira","S√£o Mateus","Gerib√°","Manguinhos","Tucuns","P√≥rtico","Cem Bra√ßas"]},
    {valor:40.00, bairros:["B√∫zios (Centro, Jo√£o Fernandes, Pernambuco)","Iguaba Grande"]},
    {valor:50.00, bairros:["Iguabinha","Tamoios"]},
    {valor:60.00, bairros:["Aquarius","Bairro S√£o Jo√£o"]},
    {valor:70.00, bairros:["Rio das Ostras (at√© a ponte)","Araruama (at√© o centro)"]},
    {valor:100.00, bairros:["Maca√© (Centro)","Saquarema (Centro)"]},
  ];

  // ========= STATE =========
  const cart = {}; // id -> qty
  const ITEMS = [...TRADICIONAIS, ...PREMIUM, ...DOCES, ...BEBIDAS, ...COMBOS];

  // ========= HELPERS =========
  function isOpenNow(){
    const now = new Date();
    const tzNow = new Date(now.toLocaleString("en-US", { timeZone: TIMEZONE }));
    const hour = tzNow.getHours();
    return hour >= OPEN_HOUR && hour < CLOSE_HOUR;
  }

  function renderHoursBanner(){
    const open = isOpenNow();
    const banner = document.getElementById("hoursBanner");
    const buttons = [document.getElementById("btn-whatsapp"), document.getElementById("btn-site")];
    if (!open){
      banner.classList.remove("hidden");
      buttons.forEach(b => b.setAttribute("disabled","disabled"));
      buttons.forEach(b => b.classList.add("opacity-50","cursor-not-allowed"));
    } else {
      banner.classList.add("hidden");
      buttons.forEach(b => b.removeAttribute("disabled"));
      buttons.forEach(b => b.classList.remove("opacity-50","cursor-not-allowed"));
    }
  }

  function add(id){ cart[id] = (cart[id]||0)+1; renderCart(); }
  function removeItem(id){ if(!cart[id]) return; cart[id]-=1; if(cart[id]<=0) delete cart[id]; renderCart(); }

  function renderList(containerId, arr){
    const el = document.getElementById(containerId);
    el.innerHTML = "";
    arr.forEach(it => {
      const row = document.createElement("div");
      row.className = "flex items-start justify-between gap-3 border rounded-xl p-3";
      row.innerHTML = \`
        <div>
          <div class="font-medium">\${it.name} <span class="text-neutral-500">‚Äî \${em(it.price)}</span></div>
          <div class="text-xs text-neutral-600">\${it.desc || ""}</div>
        </div>
        <div class="flex items-center gap-2">
          <button data-id="\${it.id}" class="btn-add rounded-lg px-3 py-2 text-sm bg-neutral-900 text-white">Adicionar</button>
          <span id="qtd-\${it.id}" class="text-sm w-6 text-center">0</span>
          <button data-id="\${it.id}" class="btn-rem rounded-lg px-3 py-2 text-sm bg-neutral-200">-</button>
        </div>
      \`;
      el.appendChild(row);
    });
    document.querySelectorAll("#"+containerId+" .btn-add").forEach(b => b.onclick = () => add(b.dataset.id));
    document.querySelectorAll("#"+containerId+" .btn-rem").forEach(b => b.onclick = () => removeItem(b.dataset.id));
  }

  function calcTaxa(bairroInput){
    const b = (bairroInput||"").trim().toLowerCase();
    if(!b) return {valor:0, found:false, note:""};
    for(const t of TAXAS){
      for(const n of t.bairros){
        if(n.toLowerCase() === b) return {valor:t.valor, found:true, note:""};
        // tentativa de "cont√©m" simples
        if(n.toLowerCase().includes(b)) return {valor:t.valor, found:true, note:"(aprox.)"};
      }
    }
    return {valor:0, found:false, note:"Ainda n√£o temos taxa cadastrada pra esse bairro üòÖ. Pode me mandar o CEP ou um ponto de refer√™ncia pra confirmar o valor? (posso conceder R$ 3,00 de desconto como cortesia üòâ)"};
  }

  function renderTaxasTabela(){
    const box = document.getElementById("taxasTabela");
    box.innerHTML = TAXAS.map(t => \`<div class="mb-2"><b>\${em(t.valor)}</b><br><span class="text-neutral-600">\${t.bairros.join(", ")}</span></div>\`).join("");
  }

  function money(v){ return v.toLocaleString("pt-BR",{style:"currency", currency:"BRL"}); }

  function renderCart(){
    const el = document.getElementById("cart");
    let subtotal = 0;
    const lines = Object.entries(cart).map(([id,q]) => {
      const it = ITEMS.find(i=>i.id===id);
      const sub = it.price*q; subtotal+=sub;
      return \`<div class="flex justify-between"><span>\${q}√ó \${it.name}</span><span>\${money(sub)}</span></div>\`;
    });
    const bairro = document.getElementById("bairro").value;
    const tk = calcTaxa(bairro);
    el.innerHTML = (lines.join("") || '<div class="text-neutral-500">Seu carrinho est√° vazio</div>');
    const rows = [];
    rows.push(\`<div class="mt-2 flex justify-between font-semibold"><span>Subtotal</span><span>\${money(subtotal)}</span></div>\`);
    rows.push(\`<div class="flex justify-between"><span>Taxa de entrega</span><span>\${tk.found? money(tk.valor)+ (tk.note? " "+tk.note:"") : "-"}</span></div>\`);
    rows.push(\`<div class="mt-1 flex justify-between text-lg font-bold"><span>Total</span><span>\${money(subtotal + (tk.found? tk.valor:0))}</span></div>\`);
    el.insertAdjacentHTML("beforeend", rows.join(""));
    Object.keys(cart).forEach(id => { const span = document.getElementById("qtd-"+id); if(span) span.textContent = cart[id]; });
  }

  function payload(){
    const p = {
      store: STORE_NAME,
      nome: document.getElementById("nome").value.trim(),
      endereco: document.getElementById("endereco").value.trim(),
      telefone: document.getElementById("telefone").value.trim(),
      obs: document.getElementById("obs").value.trim(),
      modalidade: document.getElementById("retiradaEntrega").value,
      bairro: document.getElementById("bairro").value.trim(),
      pagamento: document.getElementById("pagamento").value,
      troco: document.getElementById("troco").value.trim(),
      items: Object.entries(cart).map(([id,qty]) => {
        const it = ITEMS.find(i=>i.id===id);
        return { id, name: it.name, qty: qty, unit: it.price, subtotal: qty*it.price };
      }),
    };
    p.subtotal = p.items.reduce((a,b)=>a+b.subtotal,0);
    const tx = calcTaxa(p.bairro);
    p.taxa = tx.found ? tx.valor : 0;
    p.total = p.subtotal + p.taxa;
    p.created_at = new Date().toISOString();
    return p;
  }

  function resumoTexto(p){
    const linhas = [];
    linhas.push("Perfeito üòã!");
    if(p.items.length){
      linhas.push(p.items.map(i => `‚Ä¢ ${i.qty}√ó ${i.name}`).join("\n"));
    }
    if(p.obs) linhas.push(`‚Ä¢ Obs: ${p.obs}`);
    if(p.modalidade==="retirada"){
      linhas.push("‚Ä¢ Retirada na pizzaria: Travessa Curitiba, 12 ‚Äì Jardim Olinda, Cabo Frio ‚Äì RJ");
    }else if(p.modalidade==="entrega"){
      linhas.push(`‚Ä¢ Entrega ‚Äî Bairro: ${p.bairro}` + (p.taxa? ` ‚Äî Taxa: ${em(p.taxa)}` : ""));
    }
    if(p.pagamento) linhas.push(`‚Ä¢ Pagamento: ${p.pagamento}` + (p.troco? ` ‚Äî Troco para ${p.troco}`:""));
    linhas.push("‚Ä¢ Tempo estimado: 40 minutos üçï");
    linhas.push(`Total aproximado: ${em(p.total)}`);
    linhas.push("");
    linhas.push("Seu pedido ser√° confirmado em instantes pelo nosso atendimento humano üíõ.");
    linhas.push("üìû (22) 99229-0283 | @farinhalenha | Pizzaria Farinha & Lenha üçï.");
    return linhas.join("\n");
  }

  function whatsappText(p){
    const header = "Oi üòÑ! Sou o atendente virtual da Farinha & Lenha üçï.\n";
    const corpo = [
      "*Novo pedido*",
      p.items.map(i => `‚Ä¢ ${i.qty}√ó ${i.name} ‚Äî ${em(i.subtotal)}`).join("\n"),
      `*Subtotal:* ${em(p.subtotal)}`,
      (p.modalidade==="entrega" && p.taxa ? `*Taxa:* ${em(p.taxa)}` : ""),
      `*Total:* ${em(p.total)}`,
      "",
      (p.modalidade==="retirada" ? "Retirada: Travessa Curitiba, 12 ‚Äì Jardim Olinda, Cabo Frio ‚Äì RJ" : `Entrega ‚Äî Bairro: ${p.bairro}`),
      `Pagamento: ${p.pagamento || "-"}` + (p.troco? ` ‚Äî Troco para ${p.troco}` : ""),
      `Nome: ${p.nome}`,
      `Endere√ßo: ${p.endereco || "-"}`,
      `Telefone: ${p.telefone}`,
      (p.obs? `Obs: ${p.obs}` : ""),
      "",
      "Tempo m√©dio de preparo: ~40 min (pode variar)",
      "Se tiver d√∫vida sobre alerg√™nicos, fale com nossa equipe humana: (22) 99229-0283."
    ].filter(Boolean).join("\n");
    return encodeURIComponent(header + corpo);
  }

  // ====== EVENTS ======
  function mount(){
    renderList("menu-trad", TRADICIONAIS);
    renderList("menu-prem", PREMIUM);
    renderList("menu-doces", DOCES);
    renderList("menu-bebidas", BEBIDAS);
    renderList("menu-combos", COMBOS);
    renderTaxasTabela();
    renderCart(); renderHoursBanner();

    document.getElementById("bairro").addEventListener("input", renderCart);
    document.getElementById("retiradaEntrega").addEventListener("change", renderCart);

    document.getElementById("btn-whatsapp").onclick = () => {
      if(!isOpenNow()){
        alert("Nosso hor√°rio de atendimento √© das 18h √†s 23h. Volto assim que abrirmos üòÑ.");
        return;
      }
      const p = payload();
      if(!p.nome || !p.telefone || p.items.length===0){
        alert("Preencha nome, telefone e adicione itens ao carrinho.");
        return;
      }
      const url = "https://wa.me/" + "5522992290283" + "?text=" + whatsappText(p);
      window.open(url, "_blank");
    };

    document.getElementById("btn-site").onclick = async () => {
      if(!isOpenNow()){
        alert("Nosso hor√°rio de atendimento √© das 18h √†s 23h. Volto assim que abrirmos üòÑ.");
        return;
      }
      const p = payload();
      if(!p.nome || !p.telefone || p.items.length===0){
        alert("Preencha nome, telefone e adicione itens ao carrinho.");
        return;
      }
      if(!PRINT_WEBHOOK){
        alert("Defina PRINT_WEBHOOK (F12): localStorage.setItem('PRINT_WEBHOOK','https://SUA-URL/print')");
        return;
      }
      try{
        const headers = {"Content-Type":"application/json"};
        if(PRINT_KEY) headers["X-KEY"] = PRINT_KEY;
        const r = await fetch(PRINT_WEBHOOK, {method:"POST", headers, body: JSON.stringify(p)});
        if(!r.ok) throw new Error("Falha ao enviar");
        alert("Pedido enviado para a cozinha! " + "\n" + resumoTexto(p));
      }catch(e){
        alert("Erro: " + e.message);
      }
    };

    document.getElementById("year").textContent = new Date().getFullYear();
  }

  document.addEventListener("DOMContentLoaded", mount);
  </script>
</body>
</html>
